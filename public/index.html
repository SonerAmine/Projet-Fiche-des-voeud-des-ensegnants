<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiches de Vœux Pédagogiques</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Animate.css for additional animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- Base styles -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Modern styles with animations -->
    <link rel="stylesheet" href="css/modern-style.css">
    <!-- Additional modern styles -->
    <link rel="stylesheet" href="css/typewriter.css">
    <style>
        /* Ripple effect for buttons */
        .btn {
            position: relative;
            overflow: hidden;
        }
        
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* Input focus effect */
        .input-focused {
            transform: translateY(-3px);
            transition: transform 0.3s ease;
        }
        
        /* Wave animation for the navbar */
        .wave-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px;
            overflow: hidden;
        }
        
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 1000 150" xmlns="http://www.w3.org/2000/svg"><path d="M0,150 C200,75 300,0 500,100 C700,200 800,75 1000,150 L1000,250 L0,250 Z" fill="rgba(255,255,255,0.15)"/></svg>') repeat-x;
            animation: wave 20s linear infinite;
        }
        
        .wave2 {
            animation-duration: 15s;
            animation-delay: -5s;
            opacity: 0.3;
        }
        
        .wave3 {
            animation-duration: 25s;
            animation-delay: -2s;
            opacity: 0.1;
        }
        
        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* Particles background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        /* Card hover effects */
        .card-hover-effect {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card-hover-effect:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Progress bar for multi-step form */
        .form-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .form-progress::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--gray-300);
            transform: translateY(-50%);
            z-index: -1;
        }
        
        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--gray-600);
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .progress-step.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.3);
        }
        
        .progress-step.completed {
            background: var(--success);
            color: white;
        }
        
        /* Custom form section background patterns */
        .pattern-dots {
            background-image: radial-gradient(var(--gray-300) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .pattern-diagonal {
            background-image: linear-gradient(45deg, rgba(0, 123, 255, 0.05) 25%, transparent 25%, transparent 50%, rgba(0, 123, 255, 0.05) 50%, rgba(0, 123, 255, 0.05) 75%, transparent 75%, transparent);
            background-size: 10px 10px;
        }
        
        /* Logout button style - Fixed to ensure text is white in all states */
        .btn-logout {
            background-color: #dc3545;
            color: white !important;
            border-color: #dc3545;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .btn-logout:hover,
        .btn-logout:focus,
        .btn-logout:active {
            background-color: #bd2130 !important;
            border-color: #bd2130 !important;
            color: white !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }

        /* Override Bootstrap's nav-link hover for logout button */
        .nav-link.btn-logout:hover,
        .nav-link.btn-logout:focus,
        .nav-link.btn-logout:active {
            color: white !important;
            background-color: #bd2130 !important;
        }

        /* Improved form field styling */
        .form-control, .form-select {
            height: 50px;
            font-size: 16px;
            padding-left: 15px;
            box-shadow: none;
            border: 1px solid #ced4da;
        }

        /* Fix for Nature multiple select */
        .form-select[multiple] {
            height: auto;
            min-height: 120px;
            padding-top: 10px;
            padding-bottom: 10px;
            /* Remove the default outline and set a consistent border */
            outline: none;
            border: 1px solid #ced4da !important;
            box-shadow: none !important;
            /* Prevent browser from showing any native indicators */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .form-select[multiple]:focus {
            border-color: #4361ee !important;
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25) !important;
            outline: none;
        }

        .form-select[multiple] option {
            padding: 8px 10px;
            margin-bottom: 2px;
            border-radius: 3px;
            font-size: 15px;
            /* Remove any default browser styling that might show checkmarks */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            /* Ensure no checkmark or tick marks are shown */
            background-image: none !important;
        }

        /* Remove default browser styling for selected options */
        .form-select[multiple] option:checked {
            background-color: #4361ee !important;
            color: white !important;
            /* Remove any checkmark icons */
            background-image: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
        }

        /* Remove all native styling for options */
        .form-select[multiple] option::after,
        .form-select[multiple] option::before {
            display: none !important;
            content: none !important;
        }

        .form-select[multiple] option:hover {
            background-color: rgba(67, 97, 238, 0.2);
        }

        /* Chrome-specific fix to remove checkmarks */
        @media screen and (-webkit-min-device-pixel-ratio:0) {
            .form-select[multiple] option:checked {
                background: #4361ee !important;
                color: white !important;
                background-image: none !important;
            }
            
            /* Hide any selectors or pseudo-elements that might show checkmarks */
            .form-select[multiple] option:checked::after,
            .form-select[multiple] option:checked::before {
                display: none !important;
                content: none !important;
                background-image: none !important;
            }
        }

        /* Firefox-specific fix */
        @-moz-document url-prefix() {
            .form-select[multiple] option:checked {
                background: #4361ee !important;
                color: white !important;
                background-image: none !important;
                box-shadow: none !important;
            }
        }

        /* Override any browser-specific styles */
        .form-select[multiple]::-webkit-scrollbar {
            width: 8px;
        }

        .form-select[multiple]::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .form-select[multiple]::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .form-select[multiple]::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .form-control:focus, .form-select:focus {
            border-color: #4361ee;
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
        }

        /* Fix label positioning */
        label.form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            display: block;
            font-size: 14px;
        }

        /* Style for field labels shown above inputs */
        .field-label {
            display: block;
            font-weight: 600;
            color: #495057;
            margin-bottom: 6px;
            font-size: 14px;
        }

        /* Fix the unclear text in inputs */
        input::placeholder, 
        select::placeholder {
            color: #adb5bd;
            opacity: 1;
        }

        /* Styles for validation error messages */
        .invalid-feedback {
            color: #dc3545;
            font-size: 13px;
            margin-top: 6px;
            margin-left: 5px;
            display: block;
            position: relative;
        }

        /* Fix for icon placement - NOUVELLE APPROCHE */
        .icon-input {
            margin-bottom: 15px;
        }

        .icon-input label.field-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .icon-input .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .icon-input .input-container i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #4361ee;
            font-size: 18px;
            pointer-events: none;
            z-index: 10;
        }

        .icon-input .input-container .form-control,
        .icon-input .input-container .form-select {
            width: 100%;
            padding-left: 40px;
            height: 50px;
        }
        
        /* Improved delete button styling */
        .btn-supprimer {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            margin: 10px 0 10px 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .btn-supprimer:hover {
            background-color: #c82333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }
        
        /* Improved spacing for module choice sections */
        .module-choice-container {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        /* Styles spécifiques pour les modules historiques */
        .historique-module {
            background-color: #f0f8ff; /* Fond bleu très clair */
            border: 1px solid #b8daff; /* Bordure bleue */
            transition: all 0.3s ease;
        }
        
        .historique-module:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 123, 255, 0.1);
        }
        
        .historique-module .module-selection-header {
            background-color: rgba(0, 123, 255, 0.08);
            margin: -15px -15px 15px -15px;
            padding: 10px 15px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            border-bottom: 1px solid #b8daff;
        }
        
        .historique-module .module-selection-header h5 {
            color: #0056b3;
        }
        
        .module-choice-container .row {
            margin-bottom: 15px;
        }
        
        /* Fix alignment and spacing in the module selection area */
        .module-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .module-selection-header label {
            margin-bottom: 0;
            font-weight: 600;
        }
        
        /* Help text for multiple selects */
        .nature-help-text {
            display: block;
            margin-top: 8px;
            color: #6c757d;
            font-size: 13px;
            font-style: italic;
        }

        /* Custom class to specifically override the green checkmark */
        .no-checkmark {
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            background-image: none !important;
            background-repeat: no-repeat !important;
            background-position: right center !important;
            padding-right: 10px !important;
        }
        
        .no-checkmark option {
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            background-image: none !important;
            background: transparent !important;
        }
        
        .no-checkmark option:checked {
            background: #4361ee !important;
            color: white !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            background-image: none !important;
        }

        /* General navbar improvements */
        .navbar {
            background-color: white !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 0.8rem 0;
        }
        
        /* Fix for the header link that disappears on hover */
        .navbar-brand {
            color: var(--primary) !important;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            padding: 10px 15px;
            border-radius: 5px;
            text-shadow: none !important;
        }
        
        .navbar-brand:hover, 
        .navbar-brand:focus,
        .navbar-brand:active {
            color: var(--primary) !important;
            background-color: rgba(67, 97, 238, 0.1);
            text-shadow: none !important;
        }
        
        /* Ensure text is visible in all states */
        .navbar-brand i,
        .navbar-brand:hover i,
        .navbar-brand:focus i,
        .navbar-brand:active i {
            color: var(--primary) !important;
            margin-right: 8px;
        }
        
        /* Add subtle underline on hover for better UX */
        .navbar-brand::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 5px;
            left: 15px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        
        .navbar-brand:hover::after {
            width: calc(100% - 30px);
        }
        
        /* Ensure nav items remain visible on hover/focus states */
        .nav-link {
            color: var(--gray-700) !important;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
        }
        
        .nav-link:hover,
        .nav-link:focus,
        .nav-link:active {
            color: var(--primary) !important;
        }

        .navbar-brand img:hover, footer img:hover {
            transform: scale(1.05);
        }

        /* Ajout du style moderne pour les boutons de nature */
        .nature-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nature-checkbox {
            display: none;
        }
        .nature-label {
            display: inline-block;
            padding: 8px 18px;
            border-radius: 20px;
            background: #222a44;
            color: #fff;
            border: 2px solid #4361ee;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s, color 0.2s, border 0.2s;
            margin-bottom: 0;
        }
        .nature-checkbox:checked + .nature-label {
            background: #4361ee;
            color: #fff;
            border: 2px solid #4361ee;
            box-shadow: 0 2px 8px rgba(67,97,238,0.15);
        }
        .nature-label:hover {
            background: #2d365a;
            color: #fff;
        }
        
        /* Styles pour l'indicateur de chargement */
        .form-loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .form-loading.active {
            display: flex;
        }
        
        .loading-content {
            text-align: center;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4361ee;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="voeux-page">
    <!-- Script de correction immédiate pour la navbar en mode sombre -->
    <script>
        // Vérifier si le mode sombre est activé
        if (localStorage.getItem('darkmode') === 'active' || 
            (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && 
             localStorage.getItem('darkmode') !== 'inactive')) {
            // Appliquer immédiatement le style sombre à la navbar
            document.addEventListener('DOMContentLoaded', function() {
                const navbar = document.querySelector('.navbar');
                if (navbar) {
                    navbar.style.backgroundColor = '#0c1024';
                    navbar.style.borderBottom = '1px solid #101425';
                }
                
                // S'assurer que le texte de la navbar est également visible
                const navbarBrand = document.querySelector('.navbar-brand');
                if (navbarBrand) {
                    navbarBrand.style.color = '#ffffff';
                }
                
                const navbarLinks = document.querySelectorAll('.navbar-nav .nav-link:not(.btn-logout)');
                navbarLinks.forEach(link => {
                    link.style.color = '#ffffff';
                });
            });
        }
    </script>
    
    <!-- Bouton de changement de thème -->
    <button id="theme-switch">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M480-280q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Z"/></svg>
    </button>
    
    <!-- Fond animé avec l'image de fiche-backround.jpg -->
    <div class="voeux-background"></div>
    <div class="animated-overlay"></div>
    
    <!-- Particles.js background reste en place mais avec une opacité réduite -->
    <div id="particles-js"></div>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="images/LOGO Site.png" alt="Logo Site" style="height: 70px; margin-right: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: transform 0.3s ease;">
                Voeux Pro
            </a>
            
            <!-- Conteneur pour l'effet typewriter -->
            <div class="typewriter-container">
                <span id="typewriter-prefix">Plateforme de </span>
                <span id="typewriter-text"></span>
            </div>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link btn btn-logout py-1 px-3 mx-2" href="#" id="logout-btn">
                            <i class="bi bi-box-arrow-right me-1"></i> Déconnexion
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Wave animation -->
        <div class="wave-container">
            <div class="wave wave1"></div>
            <div class="wave wave2"></div>
            <div class="wave wave3"></div>
        </div>
    </nav>

    <div class="container mt-5">
        <!-- Alert container - Make it more prominent -->
        <div id="alert-container" class="mb-4" style="position: relative; z-index: 1000;"></div>
        
        <!-- Progress indicators -->
        <div class="form-progress mb-4 animate-on-scroll">
            <div class="progress-step active" data-step="1">1</div>
            <div class="progress-step" data-step="2">2</div>
            <div class="progress-step" data-step="3">3</div>
            <div class="progress-step" data-step="4">4</div>
        </div>
        
        <!-- Main Form -->
        <form id="voeuxForm">
            <!-- Informations personnelles -->
            <div class="card card-hover-effect animate-on-scroll">
                <div class="card-header">
                    <h4><i class="bi bi-person-badge me-2"></i>Informations personnelles</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="icon-input">
                                <label for="nom" class="field-label">Nom</label>
                                <div class="input-container">
                                    <i class="bi bi-person-fill"></i>
                                <input type="text" class="form-control" id="nom" name="nom" placeholder="Entrez votre nom" required>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="icon-input">
                                <label for="email" class="field-label">Email</label>
                                <div class="input-container">
                                    <i class="bi bi-envelope-fill"></i>
                                <input type="email" class="form-control" id="email" name="email" placeholder="Entrez votre email" required>
                                </div>
                                <small class="form-text text-muted">Format: exemple@domaine.com</small>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="icon-input">
                                <label for="telephone" class="field-label">Téléphone</label>
                                <div class="input-container">
                                    <i class="bi bi-telephone-fill"></i>
                                <input type="tel" class="form-control" id="telephone" name="telephone" 
                                       pattern="^(05|06|07)[0-9]{8}$" 
                                       placeholder="05/06/07XXXXXXXX" required maxlength="10">
                                </div>
                                <small class="form-text text-muted">Format: Numéro à 10 chiffres commençant par 05, 06 ou 07</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="icon-input">
                                <label for="grade" class="field-label">Grade</label>
                                <div class="input-container">
                                    <i class="bi bi-award-fill"></i>
                                <select class="form-select" id="grade" name="grade" required>
                                    <option value="">Sélectionnez votre grade</option>
                                    <option value="Professeur">Professeur</option>
                                    <option value="Maître de conférences">Maître de conférences</option>
                                    <option value="Maître assistant">Maître assistant</option>
                                    <option value="Assistant">Assistant</option>
                                </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="icon-input">
                                <label for="anciennete" class="field-label">Ancienneté (années)</label>
                                <div class="input-container">
                                    <i class="bi bi-clock-history"></i>
                                    <input type="number" class="form-control" id="anciennete" name="anciennete" 
                                       min="0" step="1" placeholder="Nombre d'années depuis le recrutement" required>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="icon-input">
                                <label for="departement" class="field-label">Département</label>
                                <div class="input-container">
                                    <i class="bi bi-building-fill"></i>
                                <select class="form-select" id="departement" name="departement" required>
                                    <option value="">Sélectionnez votre département</option>
                                </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="icon-input">
                                <label for="bureau" class="field-label">Bureau</label>
                                <div class="input-container">
                                    <i class="bi bi-door-open-fill"></i>
                                <input type="text" class="form-control" id="bureau" name="bureau" placeholder="Entrez votre numéro de bureau" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Choix des modules - Semestre 1 -->
            <div class="card card-hover-effect animate-on-scroll">
                <div class="card-header">
                    <h4><i class="bi bi-calendar-check me-2"></i>Choix des modules - Semestre 1</h4>
                </div>
                <div class="card-body pattern-dots">
                    <div id="choix-s1-container">
                        <!-- Les choix seront ajoutés dynamiquement ici -->
                    </div>
                    <button type="button" class="btn btn-primary mt-3" onclick="ajouterChoix('s1')">
                        <i class="bi bi-plus-circle me-2"></i>Ajouter un choix
                    </button>
                </div>
            </div>

            <!-- Choix des modules - Semestre 2 -->
            <div class="card card-hover-effect animate-on-scroll">
                <div class="card-header">
                    <h4><i class="bi bi-calendar-check me-2"></i>Choix des modules - Semestre 2</h4>
                </div>
                <div class="card-body pattern-dots">
                    <div id="choix-s2-container">
                        <!-- Les choix seront ajoutés dynamiquement ici -->
                    </div>
                    <button type="button" class="btn btn-primary mt-3" onclick="ajouterChoix('s2')">
                        <i class="bi bi-plus-circle me-2"></i>Ajouter un choix
                    </button>
                </div>
            </div>

            <!-- Historique des modules enseignés -->
            <div class="card card-hover-effect animate-on-scroll">
                <div class="card-header">
                    <h4><i class="bi bi-clock-history me-2"></i>Historique des modules enseignés</h4>
                </div>
                <div class="card-body pattern-diagonal">
                    <p class="text-muted mb-3">Sélectionnez les modules que vous avez enseignés au cours de votre carrière.</p>
                    <div id="historique-modules-container">
                        <!-- Les modules historiques seront ajoutés dynamiquement ici -->
                    </div>
                    <button type="button" class="btn btn-primary mt-3" onclick="ajouterModuleHistorique()">
                        <i class="bi bi-plus-circle me-2"></i>Ajouter un module
                    </button>
                </div>
            </div>

            <!-- Options supplémentaires -->
            <div class="card card-hover-effect animate-on-scroll">
                <div class="card-header">
                    <h4><i class="bi bi-gear-fill me-2"></i>Options supplémentaires</h4>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="heures_supplementaires" class="form-label d-flex align-items-center">
                                    <i class="bi bi-clock-fill me-2 text-primary"></i>
                                    Heures supplémentaires souhaitées
                                </label>
                                <select class="form-select" id="heures_supplementaires" name="heures_supplementaires" required>
                                    <option value="0">0 heure</option>
                                    <option value="1.5">1.5 heures</option>
                                    <option value="3">3 heures</option>
                                    <option value="4.5">4.5 heures</option>
                                    <option value="6">6 heures</option>
                                    <option value="7.5">7.5 heures</option>
                                    <option value="9">9 heures</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label d-flex align-items-center">
                                    <i class="bi bi-mortarboard-fill me-2 text-primary"></i>
                                    Encadrement PFE L3
                                </label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="pfe_l3" name="pfe_l3" role="switch">
                                    <label class="form-check-label" for="pfe_l3">Je souhaite encadrer des PFE L3</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <label for="commentaires" class="form-label d-flex align-items-center">
                                    <i class="bi bi-chat-left-text-fill me-2 text-primary"></i>
                                    Commentaires ou précisions supplémentaires
                                </label>
                                <textarea class="form-control" id="commentaires" name="commentaires" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center mt-4 mb-5 btn-submit-container">
                <button type="submit" class="btn btn-primary btn-lg btn-submit" id="submit-button">
                    <i class="bi bi-send-fill me-2"></i>Soumettre mes vœux
                </button>
                <p class="text-muted mt-2">Après soumission, un message de confirmation apparaîtra en haut de la page</p>
                
                <!-- Hidden test button, only visible if URL has ?test=true -->
                <button type="button" id="test-success-message" style="display: none; margin-top: 10px;" 
                        class="btn btn-outline-success btn-sm">
                    Tester le message de succès
                </button>
                <script>
                    // Show test button if URL has ?test=true parameter
                    if (window.location.search.includes('test=true')) {
                        document.getElementById('test-success-message').style.display = 'inline-block';
                    }
                    
                    // Add click handler to the test button
                    document.getElementById('test-success-message').addEventListener('click', function() {
                        // Trigger success message display
                        localStorage.setItem('submitButtonClicked', 'true');
                        // This will be picked up by success-message.js
                        setTimeout(function() {
                            // If the built-in function exists
                            if (typeof createSuccessMessage === 'function') {
                                createSuccessMessage();
                            }
                        }, 100);
                    });
                </script>
            </div>
        </form>
    </div>
    
    <!-- Loading indicator -->
    <div class="form-loading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="mt-3 text-primary fw-bold">Traitement en cours...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Particles.js for background effects -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <!-- Base scripts -->
    <script src="js/script.js"></script>
    <script src="js/auth.js"></script>
    <!-- Modern animations -->
    <script src="js/modern-animations.js"></script>
    <!-- Success message handler -->
    <script src="js/success-message.js"></script>
    
    <!-- Nouveau script pour les animations d'arrière-plan -->
    <script src="js/background-animations.js"></script>
    
    <!-- Script pour la gestion du mode sombre -->
    <script src="js/darkmode.js"></script>
    
    <!-- Ajout du script Typed.js -->
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    
    <!-- Modifier le conteneur de notification de déconnexion -->
    <div id="logout-notification" class="position-fixed" style="z-index: 2000; display: none; top: 15px; right: 50%; transform: translateX(50%); width: auto;">
        <div class="alert alert-info shadow" style="background-color: rgba(13, 110, 253, 0.9); color: white; border: none; border-radius: 8px; padding: 8px 16px; margin: 0;">
            <div class="d-flex align-items-center justify-content-center">
                <i class="bi bi-info-circle me-2"></i>
                <span style="font-weight: 500;">Déconnexion en cours...</span>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize particles.js
        if (typeof particlesJS !== 'undefined') {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 50, density: { enable: true, value_area: 1000 } },
                    color: { value: '#4361ee' },
                    shape: { type: 'circle' },
                    opacity: { value: 0.05, random: false },
                    size: { value: 2, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: '#4361ee',
                        opacity: 0.05,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 1.5,
                        direction: 'none',
                        random: false,
                        straight: false,
                        out_mode: 'out',
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: 'canvas',
                    events: {
                        onhover: { enable: true, mode: 'grab' },
                        onclick: { enable: true, mode: 'push' },
                        resize: true
                    },
                    modes: {
                        grab: { distance: 140, line_linked: { opacity: 0.2 } },
                        push: { particles_nb: 3 }
                    }
                }
            });
        }
        
        // Remove all checkmarks from Nature dropdowns when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Apply custom styling to remove checkmarks
            const removeGreenCheckmarks = function() {
                // Get all Nature select elements
                const natureSelects = document.querySelectorAll('select[multiple].no-checkmark');
                
                natureSelects.forEach(select => {
                    // Apply inline styles to override any browser defaults
                    select.style.backgroundImage = 'none';
                    select.style.webkitAppearance = 'none';
                    select.style.mozAppearance = 'none';
                    select.style.appearance = 'none';
                    
                    // Apply to each option
                    Array.from(select.options).forEach(option => {
                        option.style.backgroundImage = 'none';
                        option.style.webkitAppearance = 'none';
                        option.style.mozAppearance = 'none';
                        option.style.appearance = 'none';
                        
                        // Add a custom attribute to help with styling
                        option.setAttribute('data-no-checkmark', 'true');
                    });
                });
            };
            
            // Run immediately
            removeGreenCheckmarks();
            
            // Also run when any new elements might be added (after AJAX or DOM changes)
            setTimeout(removeGreenCheckmarks, 500);
            setTimeout(removeGreenCheckmarks, 1000);
            
            // Handle dynamic additions
            const observer = new MutationObserver(function(mutations) {
                removeGreenCheckmarks();
            });
            
            observer.observe(document.body, { childList: true, subtree: true });
            
            // Important: Fonction d'alerte pour afficher les messages d'erreur
            window.showAlert = function(message, type = 'danger') {
                const alertContainer = document.getElementById('alert-container');
                if (!alertContainer) return;
                
                alertContainer.innerHTML = `
                    <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                        <i class="bi bi-${type === 'danger' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-circle' : 'check-circle'}-fill me-2"></i>
                        <strong>${message}</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;
                
                // Scroll to top to see the alert
                window.scrollTo({top: 0, behavior: 'smooth'});
            };
            
            // Important: S'assurer que l'initialisation des choix est correctement faite
            // Vérifier si les containers de choix sont vides, et si oui, ajouter les premiers choix
            const container_s1 = document.getElementById('choix-s1-container');
            const container_s2 = document.getElementById('choix-s2-container');
            
            console.log('Initialisation des choix de modules...');
            
            if (container_s1 && container_s1.children.length === 0) {
                console.log('Ajout du premier choix pour le semestre 1');
                ajouterChoix('s1');
            } else {
                console.log('Le container s1 contient déjà des choix:', container_s1.children.length);
            }
            
            if (container_s2 && container_s2.children.length === 0) {
                console.log('Ajout du premier choix pour le semestre 2');
                ajouterChoix('s2');
            } else {
                console.log('Le container s2 contient déjà des choix:', container_s2.children.length);
            }
            
            // Vérifier les appels API
            fetch('/api/niveaux')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Erreur HTTP: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(`API niveaux OK, ${data.length} niveaux récupérés`);
                })
                .catch(error => {
                    console.error('Erreur lors de l\'appel à l\'API niveaux:', error);
                    showAlert('Erreur de connexion à l\'API. Veuillez réessayer ou contacter l\'administrateur.', 'danger');
                });
        });
        
        // Function to add a new module choice with improved styling
        function ajouterChoix(semestre) {
            const container = document.getElementById(`choix-${semestre}-container`);
            const choixCount = container.children.length + 1;
            
            // Create container with new styling
            const moduleChoiceContainer = document.createElement('div');
            moduleChoiceContainer.className = 'module-choice-container';
            
            // Create header with title and delete button
            const header = document.createElement('div');
            header.className = 'module-selection-header';
            
            const title = document.createElement('h5');
            title.className = 'mb-0';
            title.textContent = `Choix ${choixCount}`;
            
            const deleteButton = document.createElement('button');
            deleteButton.type = 'button';
            deleteButton.className = 'btn btn-supprimer';
            deleteButton.innerHTML = '<i class="bi bi-trash me-1"></i>Supprimer';
            deleteButton.onclick = function() {
                moduleChoiceContainer.remove();
                // Renumber remaining choices
                renumberChoices(semestre);
            };
            
            header.appendChild(title);
            header.appendChild(deleteButton);
            moduleChoiceContainer.appendChild(header);
            
            // First row - Palier and Specialite
            const row1 = document.createElement('div');
            row1.className = 'row';
            
            // Palier field
            const palierCol = document.createElement('div');
            palierCol.className = 'col-md-6 mb-3';
            
            const palierLabel = document.createElement('label');
            palierLabel.className = 'field-label';
            palierLabel.textContent = 'Palier :';
            
            const palierSelect = document.createElement('select');
            palierSelect.className = 'form-select';
            palierSelect.id = `palier_${semestre}_${choixCount}`;
            palierSelect.name = `choix_${semestre}[${choixCount-1}][palier]`;
            palierSelect.innerHTML = '<option value="">Sélectionnez un palier</option>';
            palierSelect.required = true;
            
            palierCol.appendChild(palierLabel);
            palierCol.appendChild(palierSelect);
            
            // Specialite field
            const specCol = document.createElement('div');
            specCol.className = 'col-md-6 mb-3';
            
            const specLabel = document.createElement('label');
            specLabel.className = 'field-label';
            specLabel.textContent = 'Spécialité :';
            
            const specSelect = document.createElement('select');
            specSelect.className = 'form-select';
            specSelect.id = `specialite_${semestre}_${choixCount}`;
            specSelect.name = `choix_${semestre}[${choixCount-1}][specialite]`;
            specSelect.innerHTML = '<option value="">Sélectionnez d\'abord un palier</option>';
            specSelect.required = true;
            
            specCol.appendChild(specLabel);
            specCol.appendChild(specSelect);
            
            row1.appendChild(palierCol);
            row1.appendChild(specCol);
            moduleChoiceContainer.appendChild(row1);
            
            // Second row - Module and Nature
            const row2 = document.createElement('div');
            row2.className = 'row';
            
            // Module field
            const moduleCol = document.createElement('div');
            moduleCol.className = 'col-md-6 mb-3';
            
            const moduleLabel = document.createElement('label');
            moduleLabel.className = 'field-label';
            moduleLabel.textContent = 'Module :';
            
            const moduleSelect = document.createElement('select');
            moduleSelect.className = 'form-select';
            moduleSelect.id = `module_${semestre}_${choixCount}`;
            moduleSelect.name = `choix_${semestre}[${choixCount-1}][module]`;
            moduleSelect.innerHTML = '<option value="">Sélectionnez d\'abord une spécialité</option>';
            moduleSelect.required = true;
            
            moduleCol.appendChild(moduleLabel);
            moduleCol.appendChild(moduleSelect);
            
            // Nature field
            const natureCol = document.createElement('div');
            natureCol.className = 'col-md-6 mb-3';
            
            const natureLabel = document.createElement('label');
            natureLabel.className = 'field-label';
            natureLabel.textContent = 'Nature :';
            
            // Nouveau rendu : boutons checkbox stylisés
            const natureOptions = document.createElement('div');
            natureOptions.className = 'nature-options';
            ['Cours', 'TD', 'TP'].forEach(nature => {
                const id = `nature_${semestre}_${choixCount}_${nature}`;
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'nature-checkbox';
                checkbox.id = id;
                checkbox.name = `choix_${semestre}[${choixCount-1}][nature][]`;
                checkbox.value = nature;
                
                const label = document.createElement('label');
                label.className = 'nature-label';
                label.htmlFor = id;
                label.textContent = nature;
                
                natureOptions.appendChild(checkbox);
                natureOptions.appendChild(label);
            });
            
            const helpText = document.createElement('small');
            helpText.className = 'nature-help-text';
            helpText.innerHTML = '<i class="bi bi-info-circle me-1"></i>Vous pouvez sélectionner plusieurs options';
            
            natureCol.appendChild(natureLabel);
            natureCol.appendChild(natureOptions);
            natureCol.appendChild(helpText);
            
            row2.appendChild(moduleCol);
            row2.appendChild(natureCol);
            moduleChoiceContainer.appendChild(row2);
            
            // Add to container
            container.appendChild(moduleChoiceContainer);
            
            // Initialiser les événements pour le nouveau choix - AJOUT IMPORTANT
            
            // Charger les niveaux
            chargerNiveaux(palierSelect);
            
            // Ajouter les événements
            palierSelect.addEventListener('change', async function() {
                console.log(`Palier sélectionné: ${this.value}`);
                await chargerSpecialites(this.value, specSelect);
                if (specSelect.value) {
                    const semestreNum = semestre === 's1' ? 1 : 2;
                    await chargerModules(specSelect.value, semestreNum, moduleSelect);
                }
            });
            
            specSelect.addEventListener('change', async function() {
                console.log(`Spécialité sélectionnée: ${this.value}`);
                if (this.value) {
                    const semestreNum = semestre === 's1' ? 1 : 2;
                    await chargerModules(this.value, semestreNum, moduleSelect);
                }
            });
            
            moduleSelect.addEventListener('change', function() {
                console.log(`Module sélectionné: ${this.value}`);
                const selectedOption = this.options[this.selectedIndex];
                if (selectedOption && selectedOption.dataset.nature) {
                    const natures = JSON.parse(selectedOption.dataset.nature);
                    console.log(`Natures disponibles: ${natures.join(', ')}`);
                    
                    // Mettre à jour les options de nature disponibles
                    natureOptions.querySelectorAll('input').forEach(checkbox => {
                        checkbox.checked = natures.includes(checkbox.value);
                    });
                }
            });
        }
        
        // Function to renumber choices after deletion
        function renumberChoices(semestre) {
            const container = document.getElementById(`choix-${semestre}-container`);
            const choices = container.querySelectorAll('.module-choice-container');
            
            choices.forEach((choice, index) => {
                // Update title
                const title = choice.querySelector('h5');
                title.textContent = `Choix ${index + 1}`;
                
                // Update input names
                const inputs = choice.querySelectorAll('select');
                inputs.forEach(input => {
                    const name = input.name;
                    if (name) {
                        input.name = name.replace(/choix_[^[]+\[(\d+)\]/, `choix_${semestre}[${index}]`);
                    }
                });
            });
        }
        
        // Modifier le script de déconnexion
        document.addEventListener('DOMContentLoaded', function() {
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Clear all authentication data
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    localStorage.removeItem('userId');
                    localStorage.removeItem('isAuthenticated');
                    
                    // Afficher la notification en haut à droite
                    const notification = document.getElementById('logout-notification');
                    notification.style.display = 'block';
                    
                    // Rediriger après un délai
                    setTimeout(function() {
                        window.location.href = '/login.html';
                    }, 1500);
                });
            }
        });
        
        // Direct success message implementation to ensure it works
        document.addEventListener('DOMContentLoaded', function() {
            // Add direct handler for the submit button
            const submitButton = document.getElementById('submit-button');
            if (submitButton) {
                submitButton.addEventListener('click', function(e) {
                    // Don't prevent default here to allow normal form validation
                    setTimeout(function() {
                        // Get the form
                        const form = document.getElementById('voeuxForm');
                        
                        // Check if the form is valid 
                        if (form && form.checkValidity()) {
                            // Show a loading indicator
                            const loadingElem = document.querySelector('.form-loading');
                            if (loadingElem) loadingElem.classList.add('active');
                            
                            // Ne pas simuler la communication serveur ici
                            // La fonction createSuccessMessage ou showDirectSuccessMessage
                            // sera appelée par le gestionnaire de soumission dans script.js
                            // après une réponse réussie du serveur
                        }
                    }, 100); // Small delay to let the browser's validation happen first
                });
            }
        });
        
        // Form progress steps
        document.addEventListener('DOMContentLoaded', function() {
            // Add click events to progress steps
            document.querySelectorAll('.progress-step').forEach(step => {
                step.addEventListener('click', function() {
                    const stepNumber = parseInt(this.getAttribute('data-step'));
                    goToStep(stepNumber);
                });
            });
            
            // Scroll to a specific step
            function goToStep(stepNumber) {
                // Mark step as active
                document.querySelectorAll('.progress-step').forEach(step => {
                    const currentStep = parseInt(step.getAttribute('data-step'));
                    step.classList.remove('active', 'completed');
                    
                    if (currentStep < stepNumber) {
                        step.classList.add('completed');
                    } else if (currentStep === stepNumber) {
                        step.classList.add('active');
                    }
                });
                
                // Scroll to the corresponding card
                const cards = document.querySelectorAll('#voeuxForm > .card');
                if (cards.length >= stepNumber) {
                    cards[stepNumber - 1].scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
            
            // Auto-update progress when scrolling
            window.addEventListener('scroll', function() {
                const cards = document.querySelectorAll('#voeuxForm > .card');
                cards.forEach((card, index) => {
                    const rect = card.getBoundingClientRect();
                    if (rect.top <= window.innerHeight * 0.3 && rect.bottom >= window.innerHeight * 0.3) {
                        updateProgressStep(index + 1);
                    }
                });
            });
            
            function updateProgressStep(stepNumber) {
                document.querySelectorAll('.progress-step').forEach(step => {
                    const currentStep = parseInt(step.getAttribute('data-step'));
                    step.classList.remove('active');
                    
                    if (currentStep < stepNumber) {
                        step.classList.add('completed');
                    } else if (currentStep === stepNumber) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('completed');
                    }
                });
            }
        });

        // Function to show success message directly - conservée pour être utilisée lors de soumissions réelles
        function showDirectSuccessMessage(message) {
            const alertContainer = document.getElementById('alert-container');
            if (!alertContainer) return;
            
            // Create a visually prominent alert
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show';
            alert.style.fontSize = '1.1rem';
            alert.style.fontWeight = 'bold';
            alert.style.padding = '1rem 1.25rem';
            alert.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
            alert.style.borderLeft = '5px solid #2e8540';
            alert.style.backgroundColor = '#d4edda';
            alert.style.color = '#155724';
            
            alert.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            // Clear any existing alerts
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);
            
            // Scroll to top to see the message
            window.scrollTo({top: 0, behavior: 'smooth'});
            
            // Automatically dismiss after 8 seconds
            setTimeout(() => {
                alert.classList.add('fade');
                setTimeout(() => {
                    alertContainer.innerHTML = '';
                }, 500);
            }, 8000);
        }

        // Script pour initialiser l'effet typewriter -->
        document.addEventListener('DOMContentLoaded', function() {
            // Attendre que le DOM soit complètement chargé
            setTimeout(function() {
                // Initialiser l'animation Typed.js
                var typed = new Typed('#typewriter-text', {
                    strings: [
                        "gestion des vœux pédagogiques",
                        "répartition des enseignements",
                        "coordination des modules",
                        "expression des préférences d'enseignement",
                        "planification pédagogique",
                        "attribution des cours",
                        "gestion des souhaits d'enseignement"
                    ],
                    typeSpeed: 50,          // Vitesse de frappe
                    backSpeed: 30,          // Vitesse d'effacement
                    backDelay: 2500,        // Délai avant l'effacement
                    startDelay: 800,        // Délai avant le début
                    loop: true,             // Boucler l'animation
                    showCursor: true,       // Afficher le curseur
                    cursorChar: '|',        // Caractère du curseur
                    autoInsertCss: true,    // Insérer automatiquement le CSS
                    smartBackspace: true    // Effacer seulement les caractères différents
                });
            }, 500); // Léger délai pour s'assurer que tout est chargé
        });
    </script>

    <!-- Footer with Faculty Logo -->
    <footer class="text-center mt-5">
        <img src="images/logo-usthb.jpg" alt="Logo USTHB" style="height: 110px; margin-top: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: transform 0.3s ease;">
        <p class="mt-3" style="color: #ffffff;">&copy; 2025 Voeux Pro. Tous droits réservés.</p>
    </footer>
    
    <!-- Script Socket.io -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    
    <!-- Scripts du chat -->
    <script src="js/chat-utils.js"></script>
    <script src="js/chat.js"></script>
</body>
</html>